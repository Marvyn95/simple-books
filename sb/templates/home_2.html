<!DOCTYPE html>
<html lang="en">
  <!-- Navbar -->
  <!-- Tabs -->
  <!-- Inputs Tab -->
  <!-- Debts Tab -->
  <!-- Daily figures Tab -->
  <!-- Summaries Tab -->
  <!-- People Tab -->
  <!-- Income Modal -->
<head>
  <meta charset="UTF-8">
  <title>Inputs Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  
  <link rel="stylesheet" href="styles.css">

</head>

<!-- Add Income Category Modal -->
<div class="modal fade" id="addSaleCategoryModal" tabindex="-1" aria-labelledby="addSaleCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('add_income_category') }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addSaleCategoryModalLabel">Add Income Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="incomeCategory" class="form-label">Income Category</label>
            <input type="text" class="form-control" id="incomeCategory" name="income_category" required>
          </div>
          <div class="mb-3">
            <label for="incomeDescription" class="form-label">Description (optional)</label>
            <textarea class="form-control" id="incomeDescription" name="description" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Add Category</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Add Expense Category Modal -->
<div class="modal fade" id="addExpenseCategoryModal" tabindex="-1" aria-labelledby="addExpenseCategoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('add_expense_category') }}">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addExpenseCategoryModalLabel">Add Expense Category</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label for="expenseCategory" class="form-label">Expense Category</label>
            <input type="text" class="form-control" id="expenseCategory" name="expense_category" required>
          </div>
          <div class="mb-3">
            <label for="expenseDescription" class="form-label">Description (optional)</label>
            <textarea class="form-control" id="expenseDescription" name="description" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Add Category</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Modal for adding sale -->
{% for source in org_income_categories %}
<div class="modal fade" id="incomeModal{{ loop.index }}" tabindex="-1" aria-labelledby="incomeModalLabel{{ loop.index }}" aria-hidden="true">
  <div class="modal-dialog" style="max-width: 500px;">  <!-- wider than modal-sm, still responsive -->
    <form method="POST" action="{{ url_for('add_sale') }}">
      <div class="modal-content">
        <div class="modal-header py-2">
          <h5 class="modal-title text-primary" id="incomeModalLabel{{ loop.index }}">Add Sale â€“ {{ source }}</h5>
          <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body py-2 px-3">
          <div class="mb-2">
            <label class="form-label small">Income Source</label>
            <input type="text" class="form-control form-control-sm" value="{{ source }}" readonly>
            <input type="hidden" name="income_source" value="{{ source }}">
          </div>

          <div class="mb-2">
            <label for="amount{{ loop.index }}" class="form-label small">Amount</label>
            <input type="text" class="form-control form-control-sm" id="amount{{ loop.index }}" name="amount" required>
          </div>

          <div class="mb-2">
            <label for="type{{ loop.index }}" class="form-label small">Type</label>
            <select class="form-select form-select-sm" id="type{{ loop.index }}" name="type">
              <option value="cash" selected>Cash</option>
              <option value="debt">Debt</option>
            </select>
          </div>

          <div class="mb-2">
            <label for="clientName{{ loop.index }}" class="form-label small">Client Name</label>
            <input type="text" class="form-control form-control-sm" id="clientName{{ loop.index }}" name="client_name" required>
          </div>

          <div class="mb-2">
            <label for="destination{{ loop.index }}" class="form-label small">Destination of Funds</label>
            <select class="form-select form-select-sm" id="destination{{ loop.index }}" name="destination">
              <option value="cash register" selected>Cash Register</option>
              <option value="bank">Bank</option>
              <option value="mobile money">Mobile Money</option>
            </select>
          </div>

          <div class="mb-2">
            <label for="comments{{ loop.index }}" class="form-label small">Comments</label>
            <textarea class="form-control form-control-sm" id="comments{{ loop.index }}" name="comments" rows="2"></textarea>
          </div>
        </div>

        <div class="modal-footer py-2">
          <button type="submit" class="btn btn-sm btn-success">Submit Income</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endfor %}


<!-- Modal for adding expense -->
{% for source in org_expense_categories %}
<div class="modal fade" id="expenseModal{{ loop.index }}" tabindex="-1" aria-labelledby="expenseModalLabel{{ loop.index }}" aria-hidden="true">
  <div class="modal-dialog" style="max-width: 500px;"> <!-- wider but responsive -->
    <form method="POST" action="{{ url_for('add_expense') }}">
      <div class="modal-content">
        <div class="modal-header py-2">
          <h5 class="modal-title text-danger" id="expenseModalLabel{{ loop.index }}">Add Expense â€“ {{ source }}</h5>
          <button type="button" class="btn-close btn-sm" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body py-2 px-3">
          <div class="mb-2">
            <label class="form-label small">Expense Source</label>
            <input type="text" class="form-control form-control-sm" value="{{ source }}" readonly>
            <input type="hidden" name="expense_source" value="{{ source }}">
          </div>

          <div class="mb-2">
            <label for="amount{{ loop.index }}" class="form-label small">Amount</label>
            <input type="text" class="form-control form-control-sm" id="amount{{ loop.index }}" name="amount" required>
          </div>

          <div class="mb-2">
            <label for="type{{ loop.index }}" class="form-label small">Type</label>
            <select class="form-select form-select-sm" id="type{{ loop.index }}" name="type">
              <option value="cash" selected>Cash</option>
              <option value="debt">Debt</option>
            </select>
          </div>

          <div class="mb-2">
            <label for="recipient{{ loop.index }}" class="form-label small">Recipient / Vendor</label>
            <input type="text" class="form-control form-control-sm" id="recipient{{ loop.index }}" name="recipient" required>
          </div>

          <div class="mb-2">
            <label for="payment_method{{ loop.index }}" class="form-label small">Payment Method</label>
            <select class="form-select form-select-sm" id="payment_method{{ loop.index }}" name="payment_method">
              <option value="cash" selected>Cash Register</option>
              <option value="bank">Bank</option>
              <option value="mobile money">Mobile Money</option>
            </select>
          </div>

          <div class="mb-2">
            <label for="comments{{ loop.index }}" class="form-label small">Comments</label>
            <textarea class="form-control form-control-sm" id="comments{{ loop.index }}" name="comments" rows="2"></textarea>
          </div>
        </div>

        <div class="modal-footer py-2">
          <button type="submit" class="btn btn-sm btn-danger">Submit Expense</button>
        </div>
      </div>
    </form>
  </div>
</div>
{% endfor %}



<!-- Add People / Employee Modal -->
<div class="modal fade" id="personModal" tabindex="-1" aria-labelledby="personModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 rounded-4 shadow-lg">
      <div class="modal-header bg-light">
        <h5 class="modal-title" id="personModalLabel">Register New Employee</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body px-4 py-3">
        <p class="text-muted text-center mb-3">Register your business employees</p>
        <form action="{{ url_for('register_emp') }}" method="POST">

          <!-- Username -->
          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" id="username" name="username" required>
          </div>

          <!-- Password -->
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" name="password" required>
          </div>

          <!-- Location -->
          <div class="mb-3">
            <label for="location" class="form-label">Location</label>
            <select class="form-select" name="location" id="location" required>
              <option value="" disabled selected>-- Select Employee location --</option>
              {% for loc in user["locations"] %}
                <option value="{{ loc }}">{{ loc }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Submit -->
          <div class="d-grid">
            <button type="submit" class="btn btn-success">
              Register Employee
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- manage sales categories model -->
<div class="modal fade" id="manageSalesCategoriesModal" tabindex="-1" aria-labelledby="manageSalesLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content shadow">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="manageSalesLabel">Manage Sales Categories</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="list-group">
          {% for cat in org_income_categories %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ cat }}
              <form action="{{ url_for('delete_sales_category') }}" method="POST" class="ms-2">
                <input type="hidden" name="category" value="{{ cat }}">
                <button type="submit" class="btn btn-sm btn-danger" {% if user.role != 'Owner' %}disabled{% endif %}>
                  Delete
                </button>
              </form>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>


<!-- manage expenses categories model -->
<div class="modal fade" id="manageExpenseCategoriesModal" tabindex="-1" aria-labelledby="manageExpenseLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content shadow">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="manageExpenseLabel">Manage Expense Categories</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul class="list-group">
          {% for cat in org_expense_categories %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              {{ cat }}
              <form action="{{ url_for('delete_expense_category') }}" method="POST" class="ms-2">
                <input type="hidden" name="category" value="{{ cat }}">
                <button type="submit" class="btn btn-sm btn-danger" {% if user.role != 'Owner' %}disabled{% endif %}>
                  Delete
                </button>
              </form>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<body class="bg-light">
  <!-- Navbar -->
  <nav class="navbar navbar-light bg-white shadow-sm px-3 pb-0 d-flex justify-content-between align-items-center">
    <p class="fs-2">
      <span class="fw-bold" style="color: black;">Simple</span><span class="fst-italic fw-bold" style="color: rgb(3, 148, 3);">Books</span>
    </p>
  
    <div class="d-flex align-items-center">
        <div class="dropdown pb-3">
        <a class="btn d-flex align-items-center dropdown-toggle-custom-width" href="#" role="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
            <span id="selected-location" class="flex-grow-1 text-truncate">{{ user['locations'][0] }}</span>
            <i class="bi bi-chevron-down ms-1"></i>
        </a>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="overflow-x: auto;">
            {% for location in user['locations'] %}
            <li><a class="dropdown-item location-dropdown-item" href="#">{{ location }}</a></li>
            {% endfor %}
        </ul>
        </div>

        <div class="dropdown pb-3">
          <div class="d-flex align-items-center ps-3 mx-2 dropdown-toggle-custom-width" role="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false" style="border-left: 2px solid black; color: rgb(3, 148, 3); cursor: pointer;">
            <span class="fw-bold">{{ session['username'] }}</span>
          </div>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="min-width: unset;">
            <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">Logout</a></li>
          </ul>
        </div>
    </div>
  </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'info' }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
        {% endif %}
    {% endwith %}

  <!-- Tabs -->
  <div class="container">
  <div class="tabs fw-semibold mt-2">
    <div class="d-flex justify-content-center">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="inputs-tab" data-bs-toggle="tab" data-bs-target="#inputs" type="button" role="tab">Inputs</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="debts-tab" data-bs-toggle="tab" data-bs-target="#debts" type="button" role="tab">Debts</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="figures-tab" data-bs-toggle="tab" data-bs-target="#figures" type="button" role="tab" style="white-space: nowrap;">Daily Figures</button>
        </li>
        {% if user.role == 'Owner' %}
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="summary-tab" data-bs-toggle="tab" data-bs-target="#summary" type="button" role="tab">
              Summaries
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="people-tab" data-bs-toggle="tab" data-bs-target="#people" type="button" role="tab">
              People
            </button>
          </li>
        {% endif %}
      </ul>
    </div>
  </div>

<div class="tab-content mt-3" id="myTabContent">
<!-- Inputs Tab -->
<div class="tab-pane fade show active" id="inputs" role="tabpanel">
  <div class="container py-4">
    <div class="row g-4 justify-content-center">

      <!-- Record Sales -->
      <div class="col-md-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <h4 class="card-title text-primary fs-4">ðŸ“ˆ Record Sales</h4>
            <p class="card-text text-muted fs-6">Log and keep track of today's sales transactions</p>

            {% if user.role == 'Owner' %}
              <button class="btn btn-outline-primary btn-md mb-2" data-bs-toggle="modal" data-bs-target="#addSaleCategoryModal">
                âž• Add Sale Category
              </button>
              <button class="btn btn-outline-secondary btn-md ms-2 mb-2" data-bs-toggle="modal" data-bs-target="#manageSalesCategoriesModal">
                ðŸ›  Manage
              </button>
            {% endif %}

            {% for source in org_income_categories %}
              <div class="mt-3">
                <button class="btn btn-outline-success btn-md w-100 text-start" data-bs-toggle="modal" data-bs-target="#incomeModal{{ loop.index }}">
                  âž• Add record for {{ source }}
                </button>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Record Expenses -->
      <div class="col-md-4">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <h4 class="card-title text-primary fs-4">ðŸ’¸ Record Expenses</h4>
            <p class="card-text text-muted fs-6">Log and keep track of your business expenditures.</p>

            {% if user.role == 'Owner' %}
              <button class="btn btn-outline-primary btn-md mb-2" data-bs-toggle="modal" data-bs-target="#addExpenseCategoryModal">
                âž• Add Expense Category
              </button>
              <button class="btn btn-outline-secondary btn-md ms-2 mb-2" data-bs-toggle="modal" data-bs-target="#manageExpenseCategoriesModal">
                ðŸ›  Manage
              </button>
            {% endif %}

            {% for source in org_expense_categories %}
              <div class="mt-3">
                <button class="btn btn-outline-danger btn-md w-100 text-start" data-bs-toggle="modal" data-bs-target="#expenseModal{{ loop.index }}">
                  âž– Add record for {{ source }}
                </button>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>

    </div>
  </div>
</div>


<!-- Debts Tab -->
<div class="tab-pane fade" id="debts" role="tabpanel">
  <div class="px-2">

    <!-- Tab Navigation: Pending Incomes & Pending Expenses -->
    <ul class="nav nav-underline small fw-bold d-flex justify-content-center mb-2" role="tablist">
      <li class="nav-item mx-2" role="presentation">
        <button
          class="nav-link active text-primary"
          id="pending-incomes-tab"
          data-bs-toggle="pill"
          data-bs-target="#pending-incomes"
          type="button"
          role="tab"
          aria-controls="pending-incomes"
          aria-selected="true">
          Pending Incomes
        </button>
      </li>
      <li class="nav-item mx-2" role="presentation">
        <button
          class="nav-link text-danger"
          id="pending-expenses-tab"
          data-bs-toggle="pill"
          data-bs-target="#pending-expenses"
          type="button"
          role="tab"
          aria-controls="pending-expenses"
          aria-selected="false">
          Pending Expenses
        </button>
      </li>
    </ul>


    <!-- Filter & Sort Dropdown -->
    <div class="container d-flex justify-content-center">
      <div class="dropdown mb-2" style="max-width: 600px; width: 100%;">
        <button class="btn btn-outline-dark fw-bold w-100 dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
          Filter & Sort
        </button>
        <div class="dropdown-menu p-3 shadow w-100">
          <div class="mb-2">
            <label class="form-label mb-0 small">Source</label>
            <select class="form-select form-select-sm">
              <option>All</option>
              <option>Customer</option>
              <option>Supplier</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label mb-0 small">Amount</label>
            <input type="number" class="form-control form-control-sm">
          </div>
          <div class="mb-2">
            <label class="form-label mb-0 small">Account</label>
            <select class="form-select form-select-sm">
              <option>All</option>
              <option>Cash</option>
              <option>Mobile Money</option>
              <option>Bank</option>
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label mb-0 small">Person</label>
            <select class="form-select form-select-sm">
              <option>All</option>
              <option>Mark</option>
              <option>Other</option>
            </select>
          </div>
        </div>
      </div>
    </div>


<!-- Tab Content -->
<div class="container d-flex justify-content-center">
  <div class="tab-content mt-2" style="max-height: 65vh; overflow-y: auto; max-width: 600px; width: 100%;">

    <!-- Pending Incomes Tab -->
    <div class="tab-pane fade show active" id="pending-incomes" role="tabpanel">
      {% for sale in org_pending_sales %}
        <!-- Income Entry Card -->
        <div class="card border-primary mb-3 shadow-sm">
          <div class="card-body py-3 px-4">
            <!-- Top Row: Source and Amount -->
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="text-muted small text-primary fs-5"><strong>{{ sale.income_source }}</strong></div>
              <div class="text-primary fw-bold">
                {{ "{:,.0f}".format(sale.amount) }}/=
                <small class="text-muted fw-normal">({{ "{:,.0f}".format(sale.amount_left) }}/= left)</small>
              </div>
            </div>
            <!-- Divider -->
            <hr class="my-2 border-primary opacity-25">
            <!-- Info Section -->
            <div class="row small text-muted mb-2">
              <div class="col-md-4 col-sm-12 mb-1"><strong>Date:</strong> {{ sale.date }}</div>
              <div class="col-md-4 col-sm-12 mb-1"><strong>Sales Person:</strong> {{ sale.logger_name }}</div>
              <div class="col-md-4 col-sm-12"><strong>Customer:</strong> {{ sale.client_name }}</div>
            </div>
            <!-- Action Row with Comment -->
            <div class="d-flex justify-content-between align-items-center border-top pt-2 mt-3">
              <div class="text-muted small fst-italic">
                <i class="bi bi-chat-left-text me-1"></i> {{ sale.comments }}
              </div>
              <div>
                <button class="btn btn-sm btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#pendingIncomeDetailModal{{ loop.index }}">
                  Payments history
                </button>
                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#pendingIncomeModal{{ loop.index }}">
                  Clear
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Income Payment History Modal -->
        <div class="modal fade" id="pendingIncomeDetailModal{{ loop.index }}" tabindex="-1" aria-labelledby="pendingIncomeDetailModalLabel{{ loop.index }}" aria-hidden="true">
          <div class="modal-dialog modal-md modal-dialog-scrollable">
            <div class="modal-content shadow-sm border-0">
              <div class="modal-header bg-primary text-white">
                <h6 class="modal-title mb-0" id="pendingIncomeDetailModalLabel{{ loop.index }}">Payment History</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body px-4 py-3">
                <div class="table-responsive">
                  <table class="table table-sm table-hover align-middle mb-0">
                    <thead class="table-light">
                      <tr class="small text-muted">
                        <th>Amount (UGX)</th>
                        <th>Date</th>
                        <th>Recorded By</th>
                      </tr>
                    </thead>
                    <tbody class="small">
                      {% for payment in sale.payment_history %}
                      <tr>
                        <td class="fw-semibold text-primary">{{ payment.amount }}</td>
                        <td>{{ payment.date }}</td>
                        <td>{{ payment.logger_name }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="modal-footer py-2 px-4 border-top-0">
                <button type="button" class="btn btn-outline-primary btn-sm" data-bs-dismiss="modal">Back</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Clear Income Debt Modal -->
        <div class="modal fade" id="pendingIncomeModal{{ loop.index }}" tabindex="-1" aria-labelledby="pendingIncomeModalLabel{{ loop.index }}" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" style="max-width: 420px;">
            <div class="modal-content border-0 shadow-sm rounded-3">

              <form method="POST" action="{{ url_for('clear_income_debt') }}">
                <input type="hidden" name="sale_id" value="{{ sale._id }}">                
                <div class="modal-header border-bottom-0 pb-2 pt-3 px-4">
                  <h6 class="modal-title text-primary fw-semibold" id="pendingIncomeModalLabel{{ loop.index }}">Clear Income Debt</h6>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body px-4 pt-0 pb-3">
                  <div class="mb-3">
                    <label for="pendingIncomeAmount{{ loop.index }}" class="form-label fw-semibold small text-muted">
                      Amount to Clear <span class="text-primary">({{ sale.amount_left }}/= Left)</span>
                    </label>
                    <input type="number" min="0" step="100" name="amount" required class="form-control form-control-sm" id="pendingIncomeAmount{{ loop.index }}" placeholder="Enter amount">
                  </div>

                  <!-- <div class="mb-3">
                    <label class="form-label fw-semibold small text-muted">Destination of Funds</label>
                    <div class="d-flex flex-wrap gap-2">
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="destination{{ loop.index }}" id="pendingIncomeRadio1{{ loop.index }}" value="Cash" checked>
                        <label class="form-check-label small" for="pendingIncomeRadio1{{ loop.index }}">Cash Register</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="destination{{ loop.index }}" id="pendingIncomeRadio2{{ loop.index }}" value="Bank">
                        <label class="form-check-label small" for="pendingIncomeRadio2{{ loop.index }}">Bank Account</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="destination{{ loop.index }}" id="pendingIncomeRadio3{{ loop.index }}" value="MM">
                        <label class="form-check-label small" for="pendingIncomeRadio3{{ loop.index }}">Mobile Money</label>
                      </div>
                    </div>
                  </div> -->
                </div>

                <div class="modal-footer border-top-0 px-4 pt-1 pb-3">
                  <button type="button" class="btn btn-sm btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-sm btn-primary">Save</button>
                </div>
              </form>
              
            </div>
          </div>
        </div>
      {% endfor %}
    </div>


    <!-- Pending Expenses Tab -->
    <div class="tab-pane fade" id="pending-expenses" role="tabpanel">
      {% for expense in org_pending_expenses %}
        <!-- Expense Entry Card -->
        <div class="card border-danger mb-3 shadow-sm">
          <div class="card-body py-3 px-4">
            <!-- Top Row: Expense Type and Amount -->
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="text-muted small text-danger fs-5"><strong>{{ expense.expense_source }}</strong></div>
              <div class="text-danger fw-bold">
                {{ "{:,.0f}".format(expense.amount) }}/=
                <small class="text-muted fw-normal">({{ "{:,.0f}".format(expense.amount_left) }}/= left)</small>
              </div>
            </div>

            <!-- Divider -->
            <hr class="my-2 border-danger opacity-25">

            <!-- Info Section -->
            <div class="row small text-muted mb-2">
              <div class="col-md-4 col-sm-12 mb-1"><strong>Date:</strong> {{ expense.date }}</div>
              <div class="col-md-4 col-sm-12 mb-1"><strong>Filed By:</strong> {{ expense.logger_name }}</div>
              <div class="col-md-4 col-sm-12"><strong>Recipient:</strong> {{ expense.service_provider }}</div>
            </div>

            <!-- Action Row with Comment -->
            <div class="d-flex justify-content-between align-items-center border-top pt-2 mt-3">
              <div class="text-muted small fst-italic">
                <i class="bi bi-chat-left-text me-1"></i> {{ expense.comments }}
              </div>
              <div>
                <button class="btn btn-sm btn-outline-danger me-2" data-bs-toggle="modal" data-bs-target="#pendingExpenseDetailModal{{ loop.index }}">
                  Payment history
                </button>
                <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#pendingExpenseModal{{ loop.index }}">
                  Clear
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Expense Payment History Modal -->
        <div class="modal fade" id="pendingExpenseDetailModal{{ loop.index }}" tabindex="-1" aria-labelledby="pendingExpenseDetailModalLabel{{ loop.index }}" aria-hidden="true">
          <div class="modal-dialog modal-md modal-dialog-scrollable">
            <div class="modal-content shadow-sm border-0">
              <div class="modal-header bg-danger text-white">
                <h6 class="modal-title mb-0" id="pendingExpenseDetailModalLabel{{ loop.index }}">Payment History</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body px-4 py-3">
                <div class="table-responsive">
                  <table class="table table-sm table-hover align-middle mb-0">
                    <thead class="table-light">
                      <tr class="small text-muted">
                        <th>Amount (UGX)</th>
                        <th>Date</th>
                        <th>Recorded By</th>
                      </tr>
                    </thead>
                    <tbody class="small">
                      {% for payment in expense.payment_history %}
                      <tr>
                        <td class="fw-semibold text-danger">{{ payment.amount }}</td>
                        <td>{{ payment.date }}</td>
                        <td>{{ payment.logger_name }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="modal-footer py-2 px-4 border-top-0">
                <button type="button" class="btn btn-outline-danger btn-sm" data-bs-dismiss="modal">Back</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Clear Expense Debt Modal -->
        <div class="modal fade" id="pendingExpenseModal{{ loop.index }}" tabindex="-1" aria-labelledby="pendingExpenseModalLabel{{ loop.index }}" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" style="max-width: 420px;">
            <div class="modal-content border-0 shadow-sm rounded-3">

              <form method="POST" action="{{ url_for('clear_expense_debt') }}">
                <input type="hidden" name="expense_id" value="{{ expense._id }}">                
                <div class="modal-header border-bottom-0 pb-2 pt-3 px-4">
                  <h6 class="modal-title text-danger fw-semibold" id="pendingExpenseModalLabel{{ loop.index }}">Clear Expense Debt</h6>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body px-4 pt-0 pb-3">
                  <div class="mb-3">
                    <label for="pendingExpenseAmount{{ loop.index }}" class="form-label fw-semibold small text-muted">
                      Amount to Clear <span class="text-danger">({{ expense.amount_left }}/= Left)</span>
                    </label>
                    <input type="number" min="0" step="100" name="amount" required class="form-control form-control-sm" id="pendingExpenseAmount{{ loop.index }}" placeholder="Enter amount">
                  </div>
                </div>

                <!-- <div class="mb-3">
                  <label class="form-label fw-semibold small text-muted">Source of Funds</label>
                  <div class="d-flex flex-wrap gap-2">
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="source{{ loop.index }}" id="pendingExpenseRadio1{{ loop.index }}" value="Cash" checked>
                      <label class="form-check-label small" for="pendingExpenseRadio1{{ loop.index }}">Cash Register</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="source{{ loop.index }}" id="pendingExpenseRadio2{{ loop.index }}" value="Bank">
                      <label class="form-check-label small" for="pendingExpenseRadio2{{ loop.index }}">Bank Account</label>
                    </div>
                    <div class="form-check form-check-inline">
                      <input class="form-check-input" type="radio" name="source{{ loop.index }}" id="pendingExpenseRadio3{{ loop.index }}" value="MM">
                      <label class="form-check-label small" for="pendingExpenseRadio3{{ loop.index }}">Mobile Money</label>
                    </div>
                  </div>
                </div> -->

                <div class="modal-footer border-top-0 px-4 pt-1 pb-3">
                  <button type="button" class="btn btn-sm btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-sm btn-danger">Save</button>
                </div>
              </form>
              
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

  </div>
</div>

  </div>
</div>



<!-- Daily Figures Tab -->
<div class="tab-pane fade" id="figures" role="tabpanel">
  <div class="px-2">

    <!-- Tabs: Incomes and Expenses (Bootstrap Pills) -->
    <ul class="nav nav-underline small fw-bold d-flex justify-content-center mb-2" role="tablist">
      <li class="nav-item mx-2" role="presentation">
        <button
          class="nav-link active text-primary"
          id="daily-incomes-tab"
          data-bs-toggle="pill"
          data-bs-target="#daily-incomes"
          type="button"
          role="tab"
          aria-controls="daily-incomes"
          aria-selected="true">
          Incomes
        </button>
      </li>
      <li class="nav-item mx-2" role="presentation">
        <button
          class="nav-link text-danger"
          id="daily-expenses-tab"
          data-bs-toggle="pill"
          data-bs-target="#daily-expenses"
          type="button"
          role="tab"
          aria-controls="daily-expenses"
          aria-selected="false">
          Expenses
        </button>
      </li>
    </ul>

    <!-- Filter & Sort Panel -->
    <div class="d-flex justify-content-center mb-2">
      <div class="col-12 col-sm-10 col-md-8 col-lg-6">
        <div class="dropdown">
          <button class="btn btn-outline-dark w-100 fw-bold dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            Filter & Sort
          </button>
          <div class="dropdown-menu p-3 shadow w-100">
            <div class="mb-2">
              <label class="form-label small mb-0">Source</label>
              <select class="form-select form-select-sm">
                <option>All</option>
                <option>Customer</option>
                <option>Supplier</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label small mb-0">Amount</label>
              <input type="number" class="form-control form-control-sm">
            </div>
            <div class="mb-2">
              <label class="form-label small mb-0">Account</label>
              <select class="form-select form-select-sm">
                <option>All</option>
                <option>Cash</option>
                <option>Mobile Money</option>
                <option>Bank</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label small mb-0">Person</label>
              <select class="form-select form-select-sm">
                <option>All</option>
                <option>Mark</option>
                <option>Other</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Incomes & Expenses -->
    <div class="tab-content">

      <!-- Incomes Section -->
  <div class="tab-pane fade show active" id="daily-incomes" role="tabpanel" aria-labelledby="daily-incomes-tab">
    <div class="row px-2 mt-2" style="max-height: 65vh; overflow-y: auto;">

      {% for sale in org_sales %}
      <div class="d-flex justify-content-center mb-3">
        <div class="col-12 col-sm-10 col-md-8 col-lg-6">
          <div class="bg-white rounded shadow-sm border border-primary p-3">

            <!-- Line 1: Income Source & Amount -->
            <div class="d-flex justify-content-between align-items-center mb-1">
              <span class="fw-semibold text-dark">{{ sale.income_source }}</span>
              <span class="fw-bold fs-6 text-success">{{ "{:,}".format(sale.amount) }}/=</span>
            </div>

            <hr class="my-2 border-primary">

            <!-- Line 2: Date, Seller, Client -->
            <div class="d-flex justify-content-between text-muted small mb-2">
              <span><strong>Date:</strong> {{ sale.date }}</span>
              <span><strong>Sales Person:</strong> {{ sale.logger_name }}</span>
              <span><strong>Client:</strong> {{ sale.client_name }}</span>
            </div>

            <!-- Line 3: Comment + Edit Button -->
            <div class="d-flex justify-content-between align-items-center small text-muted">
              <div>
                <i class="bi bi-chat-text me-1"></i>
                <span class="fst-italic">{{ sale.comments }}</span>
              </div>
              <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editIncomeModal{{ sale._id }}">
                Edit
              </button>
            </div>

          </div>
        </div>
      </div>

      <!-- Modal for Editing Income (Form Inside) -->
      <div class="modal fade" id="editIncomeModal{{ sale._id }}" tabindex="-1" aria-labelledby="editIncomeModal{{ sale._id }}Label" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content border-primary">
            <form method="post" action="">
              <div class="modal-header bg-primary text-white">
                <h6 class="modal-title" id="editIncomeModal{{ sale._id }}Label">Edit Income Entry</h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <input type="hidden" name="sale_id" value="{{ sale._id }}">

                <div class="mb-2">
                  <label class="form-label small">Income Source</label>
                  <select class="form-select form-select-sm" name="source">
                    {% for category in org.income_categories %}
                      <option value="{{ category.category_name }}" {% if sale.income_source == category.category_name %}selected{% endif %}>
                        {{ category.category_name }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
                
                <div class="mb-2">
                  <label class="form-label small">Amount</label>
                  <input type="number" class="form-control form-control-sm" name="amount" value="{{ sale.amount }}">
                </div>
                <div class="mb-2">
                  <label class="form-label small">Client</label>
                  <input type="text" class="form-control form-control-sm" name="client" value="{{ sale.client_name }}">
                </div>
                <div class="mb-2">
                  <label class="form-label small">Comments</label>
                  <textarea class="form-control form-control-sm" name="comments" rows="2">{{ sale.comments }}</textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary btn-sm">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      {% endfor %}

    </div>
  </div>

<!-- Expenses Section -->
<div class="tab-pane fade" id="daily-expenses" role="tabpanel" aria-labelledby="daily-expenses-tab">
  <div class="row px-2 mt-2" style="max-height: 65vh; overflow-y: auto;">

    {% for expense in org_expenses %}
    <div class="d-flex justify-content-center mb-3">
      <div class="col-12 col-sm-10 col-md-8 col-lg-6">
        <div class="bg-white rounded shadow-sm border border-danger p-3">

          <!-- Line 1: Expense Category & Amount -->
          <div class="d-flex justify-content-between align-items-center mb-1">
            <span class="fw-semibold text-dark">{{ expense.expense_source }}</span>
            <span class="fw-bold fs-6 text-danger">{{ "{:,}".format(expense.amount) }}/=</span>
          </div>

          <hr class="my-2 border-danger">

          <!-- Line 2: Date, Logger, Payee -->
          <div class="d-flex justify-content-between text-muted small mb-2">
            <span><strong>Date:</strong> {{ expense.date }}</span>
            <span><strong>Logged By:</strong> {{ expense.logger_name }}</span>
            <span><strong>Paid to:</strong> {{ expense.service_provider }}</span>
          </div>

          <!-- Line 3: Comment + Edit Button -->
          <div class="d-flex justify-content-between align-items-center small text-muted">
            <div>
              <i class="bi bi-chat-text me-1"></i>
              <span class="fst-italic">{{ expense.comments }}</span>
            </div>
            <button class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#editExpenseModal{{ expense._id }}">
              Edit
            </button>
          </div>

        </div>
      </div>
    </div>

    <!-- Modal for Editing Expense (Form Inside) -->
    <div class="modal fade" id="editExpenseModal{{ expense._id }}" tabindex="-1" aria-labelledby="editExpenseModal{{ expense._id }}Label" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-danger">
          <form method="post" action="/update-expense/{{ expense._id }}">
            <div class="modal-header bg-danger text-white">
              <h6 class="modal-title" id="editExpenseModal{{ expense._id }}Label">Edit Expense Entry</h6>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <input type="hidden" name="expense_id" value="{{ expense._id }}">

              <div class="mb-2">
                <label class="form-label small">Expense Category</label>
                <select class="form-select form-select-sm" name="category">
                  {% for category in org.expense_categories %}
                    <option value="{{ category.category_name }}" {% if expense.expense_category == category.category_name %}selected{% endif %}>
                      {{ category.category_name }}
                    </option>
                  {% endfor %}
                </select>
              </div>

              <div class="mb-2">
                <label class="form-label small">Amount</label>
                <input type="number" class="form-control form-control-sm" name="amount" value="{{ expense.amount }}">
              </div>
              <div class="mb-2">
                <label class="form-label small">Paid to:</label>
                <input type="text" class="form-control form-control-sm" name="payee" value="{{ expense.service_provider }}">
              </div>
              <div class="mb-2">
                <label class="form-label small">Comments</label>
                <textarea class="form-control form-control-sm" name="comments" rows="2">{{ expense.comments }}</textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-danger btn-sm">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    {% endfor %}

  </div>
</div>


    </div>
  </div>
</div>





      <!-- Summaries Tab -->
      <div class="tab-pane fade" id="summary" role="tabpanel">
        <div class="p-2">
        
          <!-- Date Range Section -->
          <div class="position-relative mb-3 bg-light border border-secondary rounded p-3">
            <strong style="border-bottom: solid 2px;">Period</strong>        
            <!-- Display current date range -->             
            <div class="d-flex justify-content-between align-items-center my-1">
              <div id="dateRangeDisplay" class="fw-bold large text-primary mb-1">
                20/04/2025 <span style="color: black;"> to </span>30/06/2025
              </div>              
              <button class="btn btn-sm btn-outline-secondary" onclick="toggleDatePicker()" style="font-size: 0.9rem;">
                <i class="bi bi-calendar-date"></i>
              </button>
            </div>
        
            <!-- Hidden date picker (shows when icon is clicked) -->
            <div id="datePicker" class="border rounded p-2 bg-white shadow-sm position-relative" style="z-index: 10; display: none;">
              <label class="form-label small mb-1">Start Date</label>
              <input type="date" id="startDate" class="form-control form-control-sm mb-2">
              <label class="form-label small mb-1">End Date</label>
              <input type="date" id="endDate" class="form-control form-control-sm">
            </div>
          </div>
        
          <!-- Summary -->
          <div class="bg-white rounded shadow-sm p-3 small" style="max-height: 60vh; overflow-y: auto; font-size: medium;">
            <div class="d-flex justify-content-between">
              <div><strong>Income:</strong></div>
              <div>23,900,000/=</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Expenses:</strong></div>
              <div>12,050,000/=</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Profit:</strong></div>
              <div>11,850,000/=</div>
            </div>
            <hr>
            <div class="d-flex justify-content-between">
              <div><strong>Avg Daily Income:</strong></div>
              <div>398,333/=</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Avg Daily Expense:</strong></div>
              <div>200,833/=</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Profit Margin:</strong></div>
              <div>49.6%</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Expense-to-Income Ratio:</strong></div>
              <div>50.4%</div>
            </div>
            <hr>
            <div class="d-flex justify-content-between">
              <div><strong>Best Sector:</strong></div>
              <div>Embroidery</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Worst Sector:</strong></div>
              <div>Repairs</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Top 3 Sectors:</strong></div>
              <div>Emb, Salon, Print</div>
            </div>
            <hr>
            <div class="d-flex justify-content-between">
              <div><strong>Biggest Client:</strong></div>
              <div>Zoe P/School</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Top 3 Clients:</strong></div>
              <div>Zoe, Karen, Mike</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Biggest Expense:</strong></div>
              <div>Rent</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Common Expense:</strong></div>
              <div>Wages</div>
            </div>
            <hr>
            <div class="d-flex justify-content-between">
              <div><strong>Most Profitable Day:</strong></div>
              <div>25/05/2025</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Least Profitable Day:</strong></div>
              <div>05/06/2025</div>
            </div>
            <div class="d-flex justify-content-between">
              <div><strong>Most Active Day:</strong></div>
              <div>15/06/2025</div>
            </div>
          </div>
        </div>
        
        <script>
          function toggleDatePicker() {
            const picker = document.getElementById("datePicker");
            picker.style.display = picker.style.display === "none" ? "block" : "none";
          }
        </script>
        
      </div>
    </div>
  </div>


<!-- People Tab -->
<div class="tab-pane fade" id="people" role="tabpanel">
  <div class="container-fluid py-3">
    <div class="row justify-content-center">
      <div class="col-12 col-md-10 col-lg-8">

        <!-- Add Person Button -->
        <div class="mb-3">
          <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#personModal">
            <i class="bi bi-person-plus me-1"></i> Add Employee
          </button>
        </div>

        <!-- People List -->
        <ul class="list-group shadow-sm rounded">
          {% for emp in org_employees %}
          <li class="list-group-item d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center py-2 px-3">

            <!-- Employee Info -->
            <div class="d-flex flex-column">
              <strong class="text-capitalize mb-1">{{ emp.user_name }}</strong>
              <small class="text-muted">{{ emp.role }}</small>
              {% if emp.role == 'Employee' %}
              <small class="text-muted">{{ emp.locations[0] }}</small>
              {% endif %}
            </div>

            <!-- Actions -->
            {% if emp.role == 'Employee' %}
            <div class="d-flex gap-2 mt-2 mt-md-0">
              <i class="bi bi-pencil-square text-primary fs-6" role="button" title="Edit"
                data-bs-toggle="modal"
                data-bs-target="#editModal{{ emp.user_name | replace(' ', '') }}">
              </i>
              <i class="bi bi-trash text-danger fs-6" role="button" title="Delete"
                data-bs-toggle="modal"
                data-bs-target="#deleteModal{{ emp.user_name | replace(' ', '') }}">
              </i>
              <i class="bi bi-shield-lock text-warning fs-6" role="button" title="Change Password"
                data-bs-toggle="modal"
                data-bs-target="#passwordModal{{ emp.user_name | replace(' ', '') }}">
              </i>
            </div>
            {% endif %}
          </li>

          <!-- Edit Modal -->
          <div class="modal fade" id="editModal{{ emp.user_name | replace(' ', '') }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <form method="POST" action="{{ url_for('edit_employee') }}" class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Edit Employee</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" name="emp_id" value="{{ emp._id }}">
                  <input type="hidden" name="username" value="{{ emp.user_name }}">
                  <div class="mb-2">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-control form-control-sm" name="name" value="{{ emp.user_name }}">
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Location</label>
                    <select class="form-select form-select-sm" name="location" required>
                      {% for loc in org.locations %}
                      <option value="{{ loc }}" {% if loc == emp.locations[0] %}selected{% endif %}>{{ loc }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-sm btn-primary">Save</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Delete Modal -->
          <div class="modal fade" id="deleteModal{{ emp.user_name | replace(' ', '') }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <form action="{{ url_for('delete_emp') }}" method="POST" class="modal-content">
                <div class="modal-header bg-danger text-white">
                  <h5 class="modal-title">Confirm Delete</h5>
                  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <p>Delete <strong>{{ emp.user_name }}</strong>?</p>
                  <input type="hidden" name="emp_id" value="{{ emp._id }}">
                  <input type="hidden" name="emp_name" value="{{ emp.user_name }}">
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Password Modal -->
          <div class="modal fade" id="passwordModal{{ emp.user_name | replace(' ', '') }}" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <form method="POST" action="{{ url_for('update_password') }}" class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Change Password â€“ {{ emp.user_name }}</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <input type="hidden" name="user_id" value="{{ emp._id }}">
                  <div class="mb-2">
                    <label class="form-label">New Password</label>
                    <input type="password" class="form-control form-control-sm" name="new_password" required>
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-control form-control-sm" name="confirm_password" required>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-sm btn-warning">Update</button>
                </div>
              </form>
            </div>
          </div>

          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>



  <!-- Bootstrap JS Bundle (includes Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>